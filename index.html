<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colony Counter</title>
</head>
<body>
    <label for="input">Pick your Petri dish: </label>
    <input type="file" id="input" name="input" accept="image/*"/>
    <br>
    <canvas id="canvas" width="1080" height="1080" style="max-height: 100vh;max-width: 100vw;"></canvas>

    <div>
        <p id="outputText">Colonies counted: </p>
    </div>
    <div id="settings">
        <label for="slider_L">Lightness threshold: </label>
        <input type="range" min="0.01" max="0.99" value="0.4" step="0.01" class="slider" name="slider_L" id="slider_L">

        <label for="slider_size">Size threshold: </label>
        <input type="range" min="1" max="100" value="10" step="1" class="slider" name="slider_size" id="slider_size">

        <br>

        <label for="slider_Sx">Circle centre x: </label>
        <input type="range" min="0" max="1080" value="500" step="1" class="slider" name="slider_Sx" id="slider_Sx">

        <label for="slider_Sy">Circle centre y: </label>
        <input type="range" min="0" max="1080" value="500" step="1" class="slider" name="slider_Sy" id="slider_Sy">

        <label for="slider_r">Circle radius: </label>
        <input type="range" min="0" max="500" value="400" step="1" class="slider" name="slider_r" id="slider_r">

    </div>

    <script src="index.js"></script>
    <script>
        var canvas = document.getElementById('canvas'),
        context = canvas.getContext('2d');
/*
        make_base();

        function make_base() {
            base_image = new Image();
            base_image.src = './img/3.png';
            base_image.onload = function(){
                analyse(this);
            }
        }
*/

        // https://stackoverflow.com/a/6776055
        var input = document.getElementById('input');
        input.addEventListener('change', handleFiles);

        function handleFiles(e) {


                base_image = new Image();
                base_image.src = URL.createObjectURL(e.target.files[0]);
                base_image.onload = function(){
                    URL.revokeObjectURL(base_image.src)
                    analyse(this);
                }
        }

        // Handle settings changes
        document.getElementById("settings").addEventListener("change", function(e) {
            console.log(e.target.value);
            L_threshold = slider_L.value;
            size_threshold = slider_size.value;
            S = [slider_Sx.value, slider_Sy.value];
            r = slider_r.value;
            analyse(base_image);
        })

    </script>
</body>
</html>